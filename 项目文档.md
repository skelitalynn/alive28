**2026黑客松**



SpoonOS · 最低技术使用要求（Hackathon）



为符合 SpoonOS 相关奖金发放条件，参赛项目需至少满足以下要求：



1，必须基于 SpoonOS 构建



项目需实际集成并使用 SpoonOS 作为核心系统、运行环境或关键能力层



不接受仅概念性提及或未实际调用 SpoonOS 的项目



2，必须使用以下 Agent 体系之一



React Agent（用于任务执行、交互式决策或流程编排）



Graph Agent（用于多节点关系建模、状态流转或复杂推理结构）



3，Agent 使用需与项目核心功能强相关



Agent 需在项目中承担实际功能角色



不接受仅做 Demo 展示或边缘调用的形式化使用



可能会用到的资料：SpoonOS GitHub官网https://xspoonai.github.io/



 GitHub: SpoonOS Core：https://github.com/XSpoonAi/spoon-core



Toolkit：https://github.com/XSpoonAi/spoon-toolkit



Starter：https://github.com/XSpoonAi/spoon-starter



**SpoonOS 官方文档对齐（安装/配置要点，2026-01-31 复核）**



• 安装前置：Python 3.12+（官方安装要求）



• 推荐安装：`spoon-ai-sdk`（核心）+ `spoon-toolkits`（可选）



• 配置原则：SpoonOS SDK **env-first**（运行时只读环境变量 / .env）；`config.json` 仅在 `spoon-cli` 流程中读取并导出为环境变量



###  [***\*SpoonOS\****](https://x.com/SpoonOS_ai) ***\*-\**** ***\*LLM 应用 (LLM Application Track)\****







***\*�� 核心目标：基于 SpoonOS Framework，结合 React Agent / Graph Agent 调用 LLM，构建以 Agent 为核心的可执行 AI 应用或工作流系统。项目需将 Agent 体系作为核心功能模块，而非仅用于 Demo 或辅助调用。\****



***\*�� 开发灵感\****



**·** ***\*Crypto 投研分析师\****：自动抓取推特 / 新闻 -> 情绪分析 -> 生成研究日报。



**·** ***\*社区治理 Mod\****：自动回答 Discord/Telegram 群组中的技术问题，并整理常见 FAQ。



**·** ***\*垂直领域助手\****：法律文书生成器、代码审计初筛 Agent 等。



***\*�� 技术要求\****



· 必须使用 [SpoonOS Framework](https://www.notion.so/SpoonOS-Hackathon-2f1bbd63be8780db8c59c20349715dd5?pvs=21)。



· 提交的项目需展示完整的工作流（Input -> Processing -> Output）。



***\*��更多信息\****

· [SpoonOS SDK](https://xspoonai.github.io/docs/getting-started/installation/)



 



**《活了么？》**



Goal：用 SpoonOS Graph Agent 跑通一个可执行工作流：DailyTask -> UserInput -> LLM Reflection -> proofHash -> Onchain Proof -> Badge -> Report**隐私**：内容不上链，只上 proofHash；**链上可验证坚持**，不泄露原文。



 







**MVP边界**



 **必做：**



• 连接钱包 → 选择挑战（28天）



• 每日卡片：显示当天任务 → 用户输入一句话/可选上传图 → Agent 输出结构化反馈（JSON：note/next）



• 隐私友好承诺上链：**只上链 proofHash**（不传内容）



• 里程碑 NFT：累计完成天数达到 7/14/28 时，可分别铸造 Week1/Week2/Final 里程碑 NFT



• 7天/28天报告页（简单可视化也行）



**可选（有余力再做）：**



• 见证人机制



• 自律押金池（0.001 ETH，完成退回，不完成捐给公共池）



**定义（名词表）**



• dayIndex：第几天（1..28）



• dateKey：用户时区的自然日字符串（YYYY-MM-DD）



• userInput：用户当天一句话（或图片描述）



• saltHex：随机盐（0x+hex），必须由后端生成并保存（用于幂等、追溯与复现 proofHash）。



 



ProofBuilder（生成完成证明）



in：{dateKey, normalizedText, saltHex}



out：{proofHash}



• proofHash：keccak256(utf8(dateKey + "|" + normalizedText + "|" + saltHex))，其中 saltHex 为后端生成并保存的 0x+hex 随机盐。



• streak：连续打卡天数



• milestoneId：1/2/3 对应 Week1/Week2/Final 里程碑 NFT



• startDateKey：用户开始挑战的自然日（YYYY-MM-DD，按用户 timezone 计算），由后端在首次开始挑战/首次打卡时写入并固定。



• dayIndex 计算规则（MVP 写死）：dayIndex = diffDays(startDateKey, dateKey) + 1；若 dayIndex < 1：拒绝；若 dayIndex > 28：返回 challenge completed（可提示开启新一轮挑战）



**DEMO 模式（仅演示，不上生产）**



为便于 Demo 不必等待 28 天，允许在开发环境启用演示模式。**注意：DEMO 仅缩短时间，不绕过链上条件。**



• 通过环境变量启用：DEMO_MODE=true  

• 可选指定起始日：DEMO_START_DATE_KEY=YYYY-MM-DD  

• 启用后，后端使用“虚拟 dateKey”：

  - dateKey = startDateKey + (dayIndex - 1)

  - /dailySnapshot 与 /checkin 按 dayIndex 计算 dateKey，可快速演示 1..28 天

• 生产环境必须关闭 DEMO_MODE



**DEMO 用于“快速达成里程碑 NFT”的完整流程（仍需真实上链）**

1) 连续模拟 N 天（N=7/14/28）  
   - GET /dailySnapshot?address=...&dayIndex=1..N  
   - POST /checkin（每一天都要做）

2) 每天都上链提交 proof  
   - 调用 ProofRegistry.submitProof(dayIndex, proofHash)  
   - 成功后 POST /tx/confirm

3) 达到里程碑后铸造 NFT  
   - 调用 MilestoneNFT.mintMilestone(milestoneId)  
   - 成功后 POST /milestone/mint 记录 txHash

说明：DEMO 模式不会自动生成 proof 或自动铸造，仅用于**压缩“天数”**，链上规则仍按 1..7/14/28 proof 存在来校验。



 



1. **产品闭环**



**前端发链上交易**，后端负责生成 proofHash、存日志、算 streak，前端上链成功后用 /tx/confirm 回传 txHash



**进入 -> 执行 -> 反馈 -> 里程碑 -> 分享/复用**



• Enter：连接钱包 connectWallet() -> 选择挑战 startChallenge(28)



• Daily：展示任务卡 getDailyPrompt(dayIndex) -> 提交输入 POST /checkin



• Feedback：Agent 输出结构化反馈（JSON：note/next）。



• Commit：生成 proofHash -> ProofRegistry.submitProof(dayIndex, proofHash)



• Milestone：累计完成天数达到 7/14/28 -> mint Week1/Week2/Final 里程碑 NFT



• Share：生成海报（**只显示徽章+统计，不显示内容**）



 



• 链上成就：



￮ 完成 ≥7 天：铸造 **Week1 里程碑 NFT**



￮ 完成 ≥14 天：铸造 **Week2 里程碑 NFT**



￮ 完成 28 天：铸造 **Final 里程碑 NFT** + 生成一张可分享海报（只显示徽章与统计，不泄露内容）



• 可选的“见证人机制”：



￮ 用户可邀请 1 位朋友当见证人（不看内容，只看到你是否完成）



￮ 见证人每天点一次“见证”或自动订阅你是否打卡（链上事件即可）



 



2. **SpoonOS 最低技术要求对齐**



• **项目必须基于 SpoonOS 构建**：核心流程必须跑在 SpoonOS Agent 上



• **必须使用 React Agent 或 Graph Agent**：本项目用 **Graph Agent**



• **Agent 必须承担核心功能**： 



￮ DailyPrompt 生成任务卡



￮ Reflection 输出结构化反馈（JSON：note/next），并作为报告与统计的核心输入（非边缘 Demo）。



￮ WeeklyReport/FinalReport 生成报告



￮ 不是“边缘调用/摆设 demo”



 



3. **规则（MVP ）**



**3.1 打卡频率**



• 每天最多计 1 次：同日重复提交采用 firstWins（返回第一次生成的 logId/proofHash/reflection）。



• streak 计算以 **用户时区自然日**为准



**3.2 隐私承诺上链**



• 链上 **不存 userInput**



• 链上 **只存 proofHash**



• proofHash 算法： 



￮ proofHash = keccak256(utf8(dateKey + "|" + normalizedText + "|" + saltHex))，其中 saltHex 为后端生成并保存的 0x+hex 随机盐。



￮ salt 必须存在（避免短文本被字典猜测）



**3.3 里程碑 NFT**



• 里程碑枚举：Week1(1) / Week2(2) / Final(3)



• 规则（MVP 写死）：

  - milestoneId=1：累计完成天数 >= 7

  - milestoneId=2：累计完成天数 >= 14

  - milestoneId=3：累计完成天数 >= 28

  - 同一 milestoneId 仅可铸造一次（幂等）



• 可转让：NFT（不限制 transfer）



• mint 触发：前端点击触发（用户自己发交易）；后端仅做资格判断并记录 txHash



**链上交互（MVP）**



里程碑 NFT 铸造不进入 Graph Agent 自动执行链路：前端发交易；后端通过 /milestone/mint 记录结果用于进度展示。



**合约函数（MVP 规范）**

- ProofRegistry：submitProof(uint16 dayIndex, bytes32 proofHash)

- MilestoneNFT（ERC721, NFT）：

  - mintMilestone(uint8 milestoneId) external

    - require(milestoneId in 1..3)

    - require(!milestoneMinted[msg.sender][milestoneId])

    - milestoneId=1：require 1..7 天 proof 都存在

    - milestoneId=2：require 1..14 天 proof 都存在

    - milestoneId=3：require 1..28 天 proof 都存在

    - tokenId = uint256(keccak256(abi.encodePacked(msg.sender, milestoneId)))

    - milestoneMinted[msg.sender][milestoneId] = true



**前端流程（上链交互）**

1) 用户完成每日打卡 -> 后端生成 proofHash

2) 前端调用 ProofRegistry.submitProof(dayIndex, proofHash)

3) 当累计完成天数达到 7/14/28 时，前端调用 MilestoneNFT.mintMilestone(milestoneId)

4) 交易成功后 POST /milestone/mint 记录 txHash



**后端校验点（MVP）**

- /checkin：不负责 mint，仅生成 proofHash 和进度

- /progress：返回 completedDays / milestones（用于判断里程碑资格）

- /tx/confirm：仅记录 proof txHash

- /milestone/mint：前端成功后回传，后端记录 milestones



4. **Graph Agent（节点定义 / I/O）**



目标：节点名固定、I/O 结构化、边关系清晰，便于 SpoonOS 展示完整工作流（Input → Processing → Output）。  说明：主闭环不依赖“自由聊天”。链上交易默认采用 **前端发交易**，后端负责 proofHash、进度状态与报告。



 



**4.1 总体工作流（Graph 边关系）**



• START → DailyPrompt → UserInput



• UserInput → Reflection（并行：生成反馈，给用户展示）



• UserInput → ProofBuilder → OnchainSubmit → TxConfirm → ProgressUpdate → BadgeCheck



• ProgressUpdate → WeeklyReport / FinalReport → END（用户查看或到达里程碑触发）



**条件路由**



• TxConfirm：仅在“前端发交易模式”启用（MVP 默认启用）



• WeeklyReport/FinalReport：按 range=week|final 或 dayIndex==7/28 触发



 



**4.2 节点定义（固定节点名 + I/O）**



**1) DailyPrompt（每日引导）**



• **in**：{dayIndex, timezone?}



• **out**：{title, instruction, hint?}



• **规则**



￮ 任务来源：tasks.json（MVP）



￮ instruction 建议 ≤ 30 字；hint ≤ 20 字（可选）



 



**2) UserInput（用户输入规范化）**



• **in**：{text?, imageUrl?}



• **out**：{normalizedText, imageDesc?}



• **规则**



￮ normalizedText：去噪/截断/统一格式（用于后续 LLM 与 proof）



￮ imageDesc：MVP 可不做 OCR，建议让用户补一句描述



 



**3) Reflection（LLM 节点：反馈生成）**



• **in**：{task, normalizedText}



• **out（推荐）**：{note, next}



￮ note：短评（≤ 50 字，口语、具体，避免套话）



￮ next：下一步（≤ 30 字，**1 个动作**，10 分钟内可开始）



• **规则（必须）**



￮ 只输出 JSON，不得夹带 Markdown/解释文字



￮ 解析失败必须有兜底模板（保证前端不崩）



 



**4) ProofBuilder（生成完成证明）**



• **in**：{dateKey, normalizedText, saltHex}



• **out**：{proofHash}



• **规则**



￮ proofHash = keccak256(utf8(dateKey + "|" + normalizedText + "|" + saltHex))其中 saltHex 为后端生成并保存的 0x+hex 随机盐。



￮ salt 必须由后端生成并保存（用于一致性/追溯）



￮ **幂等策略**：同一 address + challengeId + dateKey 重复提交时，返回已有 proofHash（firstWins）



 



**5) OnchainSubmit（上链提交 / 工具节点）**



• **in**：{dayIndex, proofHash}



• **out（前端发交易模式）**：{submitHint}



￮ submitHint 示例：合约方法名、参数、合约地址（或可为空，由前端直接调用）



• **out（后端代发模式，可选）**：{txHash}



• **说明**



￮ MVP 默认：前端发交易，因此本节点不一定产出 txHash



 



**6) TxConfirm（交易回传确认，前端发交易必备）**



• **in**：{address, dateKey, dayIndex, txHash, chainId, contractAddress}



• **out**：{txStatus}（MVP 仅使用 SUBMITTED）



• **side effect**



￮ 写回 DailyLog.txHash/status（MVP 可不查链确认，仅标记 SUBMITTED）



 



**7) ProgressUpdate（状态节点：写库 + 计算 streak）**



• **in**：{address, dateKey, dayIndex, proofHash, txHash?}



• **out**：{streak, completedDays, milestones}



• **side effect**



￮ Upsert DailyLog（或更新）



￮ 更新 UserProgress：streak/lastDateKey/lastDayIndex



 



**8) BadgeCheck（资格判断）**



• **in**：{address, streak, todayCheckedIn, completedDays, milestones}



• **out**：{eligibleMilestones}



￮ eligibleMilestones：满足条件但尚未铸造的 milestoneId 列表（1/2/3）



• **说明**



￮ Mint 可由前端按钮触发（更符合真实钱包流程）



￮ 后端仅判断资格并返回建议状态



 



**9) WeeklyReport / FinalReport（总结报告）**



• **in**：{logs[]}（仅使用 reflection/统计，不使用 raw input）



• **out**：{reportText, chartData}



• **规则**



￮ 报告生成可模板化（MVP）或 LLM 汇总（加分）

￮ 若使用 LLM：可参考 task + normalizedText + reflection 作为总结输入，但**不得引用/复述用户原文**，只输出抽象总结



￮ chartData 用于前端可视化（打卡日历、关键词等）



 



**4.3 关键工程约束（必须写死）**



**A. 幂等与唯一性**



• UNIQUE(address, challengeId, dateKey)



• 重复 checkin：返回原 logId/proofHash，并设置 alreadyCheckedIn=true



**B. 隐私策略**



• raw input 默认不存；如存需截断/脱敏



• 报告不输出用户原文；如使用 LLM，可参考 task + normalizedText + reflection，但必须“去引用化”，避免任何原话或可识别内容



**C. 容错兜底**



• Reflection 输出 JSON 解析失败：启用固定兜底（保证前端渲染稳定）



• 链上回传缺失：允许 DailyLog.status=CREATED，待 TxConfirm 补全



 



**D. 前端/后端职责边界（必须写死）**

• 前端不得实现业务 API（Next.js /app/api/* 仅允许静态资源或简单代理）；Reflection / 报告 / metadata / 里程碑资格判断与记录均由后端负责

• 前端只调用后端接口（/checkin /report /metadata/{tokenId}.json /milestone/mint 等），不得自行生成 proofHash/日历/里程碑资格

• DEMO_MODE 仅后端生效：前端不自行计算虚拟 dateKey；只使用后端返回的 dateKey/dayBtnTarget/资格字段


**4.4 MVP 验收点**



• Graph 日志可展示节点流转：DailyPrompt → UserInput → Reflection → ProofBuilder → TxConfirm → ProgressUpdate → BadgeCheck



• 链上证据：txHash 可在浏览器查看 / 事件可查



• 状态变化：streak 增长、里程碑资格变化、报告可生成



![img](file:///C:\Users\86183\AppData\Local\Temp\ksohtml14708\wps1.jpg) 



 



 



5. **Prompt 规范（强约束）**



**5.1 DailyPrompt（模板驱动 ）**



**输入**：dayIndex，可选 recentSummary（最近 1-3 天摘要）

**输出格式**：**只输出 JSON**，不得包含 Markdown、解释文本、换行以外内容。



**输出 JSON（必须字段）**



• title：string，中文，<= 16 字



• instruction：string，中文，<= 30 字，必须是“用户要做的动作”



• hint：string|null，中文，<= 20 字（可为空）



**规则**



• 任务主体优先来自 tasks.json（保证 28 天一致）



• 允许在不改变任务含义的前提下，对 instruction/hint 做轻度改写以贴合用户语气



• 禁止出现诊断、说教、辱骂、敏感词引导



**示例（合规输出）**



{"title":"Day 6 接纳情绪","instruction":"写下今天最强烈的情绪，不评判。","hint":"用“我感到___，因为___”。"}



**5.2 Reflection（固定反馈）**



5.2 Reflection（固定反馈，MVP 统一为 note/next）



输入：task + normalizedText



输出格式：只输出 JSON，不得包含 Markdown、解释文本、额外字段。



 



输出 JSON（必须且仅有字段）



note：string，<= 50 字。短评，口语、具体，避免套话与说教。



next：string，<= 30 字。只给 1 个“今天能做”的动作，10 分钟内可开始。



 



next 规则（必须满足）



只给 1 个建议



具体、可在 10 分钟内开始



避免口号：禁止“加油/相信自己/要努力”



禁止医疗/心理诊断与用药建议



禁止高风险行为引导



 



示例（合规输出）



{"note":"你今天确实很累，但还是把这一步做完了。","next":"现在用1分钟写下：我最想保住的边界是__。"}



**5.3 容错**



• 如果解析 JSON 失败：尝试从文本中提取 JSON 子串再解析



• 仍失败：返回固定失败模板，确保前端正常运行



• 所有输出字段强制截断到字数上限



 



6. **合约设计（MVP）**



**6.1 ProofRegistry.sol**



**状态：**



• mapping(address => mapping(uint16 => bytes32)) proofs;



**接口：**



• submitProof(uint16 dayIndex, bytes32 proofHash) external;



• getProof(address user, uint16 dayIndex) external view returns (bytes32);



**事件：**



• event ProofSubmitted(address indexed user, uint16 indexed dayIndex, bytes32 proofHash);



**约束（MVP 写死）**



- require(dayIndex >= 1 && dayIndex <= 28)

- require(proofs[msg.sender][dayIndex] == bytes32(0)) // 不允许覆盖



**6.2 MilestoneNFT.sol（ERC721 + NFT：Week1/Week2/Final）**



**核心目标**



• 里程碑 NFT：当累计完成天数达到 7/14/28 后可铸造 Week1/Week2/Final



• NFT：允许转让（不限制 transfer）



**状态（MVP 写死）**



• IProofRegistry public immutable proofRegistry;



• mapping(address => mapping(uint8 => bool)) public milestoneMinted;



**tokenId 规则（MVP 写死）**



• tokenId：uint256(keccak256(abi.encodePacked(user, milestoneId)))



  其中 milestoneId ∈ {1,2,3}



**函数签名（MVP 规范）**



• mintMilestone(uint8 milestoneId) external;



• tokenURI(uint256 tokenId) public view returns (string memory);

  - 最简：return baseURI + tokenId



**事件（MVP）**



• event MilestoneMinted(address indexed user, uint8 indexed milestoneId, uint256 tokenId);



**权限（MVP 写死）**



• 不使用 Ownable/onlyOwner 限制



• 用户只能为自己 mint：msg.sender 为铸造对象



**校验规则（MVP 写死）**



• milestoneId 只能 1/2/3



• milestoneId=1：require 1..7 天 proof 都存在



• milestoneId=2：require 1..14 天 proof 都存在



• milestoneId=3：require 1..28 天 proof 都存在



• 同一 milestoneId 只能 mint 一次



**Metadata / tokenURI（最简方案）**



• baseURI = https://api.YOUR_DOMAIN/metadata/



• tokenURI 返回：baseURI + tokenId + ".json"



**图片资源（固定图，MVP 方案）**



为保证 Demo 稳定性，本次不使用 AI 生成图，统一使用固定图片：



• Week1 图片：`https://YOUR_DOMAIN/static/week1.png`



• Week2 图片：`https://YOUR_DOMAIN/static/week2.png`



• Final 图片：`https://YOUR_DOMAIN/static/final.png`



**MilestoneNFT metadata（示例：Week1）**

{

  "name": "Alive28 - Week1",

  "description": "Alive28 milestone NFT for completing 7 days.",

  "image": "https://YOUR_DOMAIN/static/week1.png",

  "attributes": [

    {"trait_type": "Type", "value": "MilestoneNFT"},

    {"trait_type": "Milestone", "value": "Week1"},

    {"trait_type": "Days", "value": 7},

    {"trait_type": "Challenge", "value": "Alive28"}

  ]

}



说明：Week2/Final 的 metadata 结构相同，仅替换 image 与 Milestone/Days 字段。



**6.3 RestartStaking.sol 设计方案（Optional，不进入 MVP）这个押金池好像不在MVP里实现**



**状态变量**



• uint256 public constant STAKE_AMOUNT = 0.001 ether;：固定质押金额。



• mapping(address => bool) public hasActiveStake;：记录用户当前是否有正在进行的质押。



• address public immutable nftContract;：关联的 NFT 合约地址，用于核实挑战完成情况。



**核心接口**



1. stake() external payable;



￮ **逻辑**：检查 msg.value == 0.001 ether 且用户当前未在质押状态。



￮ **约束**：一旦质押，该地址在 ProofRegistry 中的打卡才被视为有效（可在 Registry 中引用此合约状态）。



2. claimRefund() external**;**



￮ **逻辑**：用户完成 28 天挑战并获得最高等级 NFT 后，调用此函数取回 0.001 ETH。



￮ **校验**：调用 MilestoneNFT.milestoneMinted(msg.sender, 3) == true（Final 里程碑已铸造）。



3. emergencyForfeit() external onlyOwner;（可选）



￮ **逻辑**：用于清理长期未完成挑战且放弃打卡的沉淀资金，可转入国库或作为协议收入。



 



7. **后端（API + 数据结构）**



数据库选择：SQLite



**7.1 表结构（MVP）**



**UserProgress**



| **字段名**     | **类型(建议)** | **允许空** | **主键/索引** | **默认值**      | **说明**                               |

| -------------- | -------------- | ---------- | ------------- | --------------- | -------------------------------------- |

| address        | varchar(42)    | 否         | **PK**        |                 | EVM 地址（建议全小写存）               |

| display_name   | varchar(32)    | 是         | idx(可选)     | NULL            | 展示名；为空时前端用 0xabc... 缩写显示 |

| avatar_url     | varchar(512)   | 是         |               | NULL            | 头像 URL（可为空）                     |

| timezone       | varchar(64)    | 否         |               | "Asia/Shanghai" | IANA 时区                              |

| challenge_id   | int            | 否         | idx(可选)     | 1               | 方便未来支持多挑战                     |

| start_date_key | char(10)       | 否         |               |                 | YYYY-MM-DD（按时区）                   |

| streak         | int            | 否         |               | 0               | 连续天数                               |

| last_date_key  | char(10)       | 是         |               |                 | 最近一次打卡的 YYYY-MM-DD              |

| last_day_index | int            | 是         |               |                 | 最近一次打卡的 dayIndex                |

| milestones     | json / text    | 是         |               | {"1":null,"2":null,"3":null} | 里程碑 NFT txHash 映射（1/2/3）        |

| created_at     | timestamp      | 否         |               | now()           | 创建时间                               |

| updated_at     | timestamp      | 否         |               | now()           | 更新时间                               |



 



约束：



• address 全小写存储（应用层规范）



• timezone 应在“开始挑战”时固定



• start_date_key应在“开始挑战/首次打卡”时固定



**DailyLog**



| ***\*字段名\**** | ***\*类型(建议)\**** | ***\*允许空\**** | ***\*主键/索引\**** | ***\*默认值\**** | ***\*说明\****                                       |

| ---------------- | -------------------- | ---------------- | ------------------- | ---------------- | ---------------------------------------------------- |

| id               | uuid / varchar(36)   | 否               | ***\*PK\****        | uuid()           | 日志主键                                             |

| address          | varchar(42)          | 否               | ***\*IDX\****       |                  | 关联用户                                             |

| challenge_id     | int                  | 否               |                     | 1                | 同一用户不同挑战区分                                 |

| day_index        | int                  | 否               | idx(可选)           |                  | 1..28（建议后端根据日期计算）                        |

| date_key         | char(10)             | 否               | ***\*IDX\****       |                  | YYYY-MM-DD（按用户时区）                             |

| input_hash       | char(64)             | 是               |                     |                  | sha256(normalized_text)（可选，用于调试/去重）       |

| normalized_text  | text                 | 是               |                     |                  | 可不存原文；存也建议脱敏/截断                        |

| reflection       | json / text          | 否               |                     |                  | 固定 JSON：{"note":"...","next":"..."}（严格 JSON） |

| salt_hex | varchar(128) | 否 | | | 0x+hex（固定保存）                             |

| proof_hash       | char(66)             | 否               |                     |                  | 0x + 64 hex（bytes32）                               |

| status           | varchar(24)          | 否               | idx(可选)           | "CREATED"        | CREATED / SUBMITTED（MVP 不进入 CONFIRMED）          |

| chain_id         | int                  | 是               |                     |                  | 例如 11155111                                        |

| contract_address | varchar(42)          | 是               |                     |                  | ProofRegistry 地址（重部署不丢记录）                 |

| tx_hash          | char(66)             | 是               |                     |                  | 前端上链后回传                                       |

| block_number     | int                  | 是               |                     |                  | 可选：确认时填                                       |

| created_at       | timestamp            | 否               |                     | now()            | 创建时间                                             |



约束：



• UNIQUE(address, challenge_id, date_key) 同一个用户同一个挑战同一天只会有一条记录



**关系与查询（写接口用）**



UserProgress.address 1 — N DailyLog.address



/progress 常用查询：



• UserProgress 取 streak/last_date_key/milestones



• DailyLog 按 address + challenge_id 查 day_index 列表



/report 常用查询：



• DailyLog 过滤最近 7 天/全部 28 天（按 date_key 排序）



 



**7.2 API**



**Base URL**



• 生产：https://api.alive28.xyz（示例）



• 本地：http://localhost:8000



**Content-Type**



• 请求/响应：application/json; charset=utf-8



**通用字段规范**



• address：EVM 地址字符串（后端统一转小写存储）



• timezone：IANA 时区（如 Asia/Shanghai、America/Los_Angeles）



• dateKey：按用户时区计算的自然日，格式 YYYY-MM-DD



• challengeId：挑战/批次标识（MVP 默认固定为 1）



• 幂等规则：同一用户同一挑战同一天只允许 1 条日志（建议 UNIQUE(address, challengeId, dateKey)）；重复打卡返回同一条记录并标记 alreadyCheckedIn=true



**统一错误返回格式**



JSON {  "error": {   "code": "INVALID_ARGUMENT",   "message": "dayIndex must be between 1 and 28",   "details": {}  } }



常见 code：INVALID_ARGUMENT / NOT_FOUND / CONFLICT / INTERNAL / RATE_LIMITED（可选）



 



7.1 **Health**



**GET** **/health**

用于部署检查与联调。



Response 200



JSON {"status":"ok","version":"mvp-1.0.0"}



 



7.2 **Prompt（任务卡）**



**GET** **/dailyPrompt**

获取当天任务卡（MVP：从 tasks.json 读取）。



Query



• dayIndex（必填，int，1..28）



• timezone（可选，string，默认 Asia/Shanghai）



Response 200



JSON {  "challengeId": 1,  "dayIndex": 6,  "title": "Day 6 接纳情绪",  "instruction": "记录今天最强烈的情绪，不评判。",  "hint": "写“我感到___，因为___”。" }



Errors



• 400 INVALID_ARGUMENT：dayIndex 超范围



7.2.1 **HomeSnapshot（新增）**



**GET** **/homeSnapshot**



用途：首页 Day 按钮快速跳转。



Query



• address（必填）



Response 200



JSON {  "dayBtnLabel":"Day 7",  "dayBtnTarget":7,  "startDateKey":"2026-01-25",  "todayDateKey":"2026-01-31" }



7.2.2 **DailySnapshot（新增）**



**GET** **/dailySnapshot**



用途：Daily 页聚合数据（任务卡 + 今日 log）。



Query



• address（必填）



• dayIndex（必填，1..28）



Response 200



JSON {  "dateKey":"2026-01-31",  "task":{ "dayIndex":7, "title":"...", "instruction":"...", "hint":"..." },  "log":{ "id":"uuid", "address":"0x...", "challengeId":1, "dayIndex":7, "dateKey":"2026-01-31", "normalizedText":"...", "reflection":{"note":"...","next":"..."}, "saltHex":"0x...", "proofHash":"0x...", "status":"CREATED", "txHash":null, "createdAt":"2026-01-31T12:00:00Z" },  "alreadyCheckedIn":true }



说明



• log 的查找以 address + dateKey 为准（同日 only one），前端对齐 mock 行为。



 



7.3 **用户资料（可选但建议）**



**GET** **/user**

获取用户资料（展示名/头像/时区）。



Query



• address（必填）



Response 200



JSON {  "address":"0xabc...",  "displayName":"小明",  "avatarUrl":null,  "timezone":"Asia/Shanghai",  "challengeId":1,  "createdAt":"2026-01-29T10:00:00Z",  "updatedAt":"2026-01-29T10:10:00Z" }



**POST** **/user**

更新用户资料（MVP 不做鉴权；更严谨可加签名验证）。



Body



JSON {  "address":"0xabc...",  "displayName":"小明",  "avatarUrl":"https://.../avatar.png",  "timezone":"Asia/Shanghai" }



Response 200



JSON {"ok":true}



Errors



• 400 INVALID_ARGUMENT



鉴权说明（MVP-0 / MVP-1）



MVP-0（默认）：不做鉴权



• 服务端仅以 address 作为用户标识，不验证消息签名；



• 风险：任何人可以伪造任意 address 提交打卡（仅用于 hackathon demo 可接受）。



MVP-1（可选增强）：基于钱包签名校验



• 新增 GET /auth/nonce?address=0x... 返回 nonce



• POST /auth/verify：{address, nonce, signature} 校验通过后返回短期 token（或 session）



• POST /checkin 与 POST /user 在 Header 带 Authorization: Bearer <token>（或直接每次带 signature 也可）



 



7.4 **Check-in（打卡主链路）**



**POST** **/checkin**

打卡：生成反馈 + proofHash + 更新 streak（后端不负责上链）。



Body



JSON {  "address":"0xabc...",  "dayIndex":6,  "text":"今天有点累，但还是完成了任务。",  "timezone":"Asia/Shanghai",  "imageUrl":null }



Response 200



JSON {  "log":{ "id":"b5a1f7c7-9df7-4f31-8b3b-3c7a0a9c3e1d", "address":"0xabc...", "challengeId":1, "dayIndex":6, "dateKey":"2026-01-29", "normalizedText":"...", "reflection":{ "note":"你今天确实很累，但还把这一步做完了。", "next":"现在用1分钟写下：我最想保住的边界是__。" }, "saltHex":"0x...", "proofHash":"0x1234...abcd", "status":"CREATED", "txHash":null, "createdAt":"2026-01-29T10:10:00Z" }, "alreadyCheckedIn":false }



字段说明



• reflection：固定结构 {"note":"...","next":"..."}（严格 JSON）



• proofHash：keccak256(utf8(dateKey + "|" + normalizedText + "|" + saltHex))，其中 saltHex 为后端生成并保存的 0x+hex 随机盐。



• dayIndex：必填（1..28）；MVP 以请求体传入为准，仅校验范围

• timezone / imageUrl：可选字段（前端 HTTP 模式可不传）



Errors



• 400 INVALID_ARGUMENT：参数格式错误、文本超长等



• 409 CONFLICT：唯一约束冲突（若未做 firstWins 查询返回）



 



7.4.1 **AI Reflection（后端生成）**

**POST** **/ai/reflection**

用途：前端需要即时反思内容时调用；后端可走 LLM 或模板兜底。

Body

JSON {  "task":{ "dayIndex":6, "title":"...", "instruction":"...", "hint":"..." },  "userText":"...",  "dayIndex":6 }

Response 200

JSON { "reflection": { "note":"...", "next":"..." } }

约束（写死）

- 仅返回 note/next（严格 JSON）

- LLM 失败必须兜底模板，不得报错


7.4.2 **AI 生成 NFT 图片（后端生成）**

**POST** **/ai/generate-nft**

用途：根据当天任务与输入生成 NFT 图片（Data URI）。

Body

JSON {  "dayIndex":6,  "taskTitle":"Day 6",  "userText":"...",  "reflectionNote":"...",  "reflectionNext":"..." }

Response 200

JSON { "success": true, "image": "data:image/...;base64,xxxx", "dayIndex": 6, "message": "Day 6 NFT generated" }

约束（写死）

- 图片可来自 AI 或兜底 SVG

- 返回必须是可直接展示的 data URI


7.5 **Onchain Tx 回传（前端发交易模式必备）**



**POST** **/tx/confirm**

前端调用合约提交 proof 后，把 txHash 回传给后端，用于展示与对账。



Body



JSON {  "logId":"b5a1f7c7-9df7-4f31-8b3b-3c7a0a9c3e1d",  "address":"0xabc...",  "txHash":"0xdeadbeef...",  "chainId":11155111,  "contractAddress":"0xproofregistry..." }



Response 200



JSON {"ok":true}



Errors



• 404 NOT_FOUND：logId 不存在



• 409 CONFLICT：该日志已绑定 txHash



• 400 INVALID_ARGUMENT：txHash 格式错误



 



7.6 **进度查询**



**GET** **/progress**

获取用户进度（进度页/徽章页）。



Query



• address（必填）



• challengeId（可选，默认 1）



Response 200



JSON {  "dateKey":"2026-01-31",  "streak":4,  "completedDays":[1,2,3,4,6],  "milestones":{"1":null,"2":null,"3":null},  "startDateKey":"2026-01-25" }



Errors



• 404 NOT_FOUND：用户不存在（建议首次 checkin 自动创建）



7.7 **里程碑 NFT 铸造确认（新增）**



**POST** **/milestone/mint**



用途

- Week1 / Week2 / Final 里程碑 NFT 铸造回传



Body



JSON {  "address":"0xabc...",  "milestoneId":1,  "txHash":"0x...",  "chainId":11155111,  "contractAddress":"0x..." }



milestoneId 枚举：1 | 2 | 3



Response 200



JSON {  "ok":true,  "milestones":{ "1":"0x...", "2":null, "3":null } }



规则（写死）

- 1：累计完成天数 >= 7

- 2：累计完成天数 >= 14

- 3：累计完成天数 >= 28

- 判断只用 completedDays（去重 dayIndex），不使用 streak

- 已铸造则幂等返回



7.8 **报告（周报/结营）**



**GET** **/report**

生成报告（MVP：可模板拼接；加分：LLM 汇总）。

LLM 汇总建议输入：task + normalizedText + reflection，但输出不得包含原文内容。



Query



• address（必填）



• range（必填）：week | final



• challengeId（可选，默认 1）



Response 200



JSON {  "title":"周报（模拟）",  "reportText":"这一周你完成了4天打卡…",  "recentLogs":[ { "id":"uuid", "address":"0x...", "challengeId":1, "dayIndex":7, "dateKey":"2026-01-31", "normalizedText":"...", "reflection":{"note":"...","next":"..."}, "saltHex":"0x...", "proofHash":"0x...", "status":"CREATED", "txHash":null, "createdAt":"2026-01-31T12:00:00Z" } ],  "chartByDay":[0,1,0,2,0,0,1,...],  "range":"week" }



Errors



• （MVP）无打卡记录时返回空报告文本，不抛 404



Notes



• 报告不输出用户原文；如用 LLM，可参考 task + normalizedText + reflection，但需避免原话/可识别信息



7.9 **字段规范补充（MVP）**



**Reflection 推荐结构（去机械化）**



JSON {"note":"短评（<=50字）","next":"下一步（1个动作，<=30字，10分钟内可开始）"}



**Hash 字段格式**



• proofHash：0x + 64 hex（bytes32）



• txHash：0x + 64 hex



7.10 **端到端调用示例（前端视角）**



D.1 每日流程（Day 1..28）

1. GET /homeSnapshot?address=...

2. GET /dailySnapshot?address=...&dayIndex=...

3. POST /checkin -> log + reflection + proofHash

4. 合约 submitProof(dayIndex, proofHash) -> txHash

5. POST /tx/confirm

6. GET /progress?address=...



D.2 结营流程（第 28 天后）

1. GET /report?range=final



里程碑流程（Week1/Week2/Final）

1. 满足完成天数（>=7/14/28）

2. 交易成功后 POST /milestone/mint（milestoneId=1/2/3, txHash）



7.11 **Metadata（最简）**



**GET** **/metadata/{tokenId}.json**



用途：为里程碑 NFT 提供最简 metadata（可先返回固定占位图）。



Response 200



JSON metadata（见 6.2 的示例）。固定图规则：

• Week1 → week1.png

• Week2 → week2.png

• Final → final.png



9. **技术栈**



**技术栈（MVP 推荐）**



**后端**



• **Python 3.12+**（与 SpoonOS 官方安装要求一致）



• **FastAPI**（REST API）



• **SpoonOS / spoon_ai**（Graph Agent：StateGraph + GraphAgent）



• **SQLite**（本地文件数据库，MVP 使用）



• **SQLModel + SQLAlchemy**（ORM）



• **Alembic**（数据库迁移）



• **eth-hash + eth-utils**（keccak256 / hex 编码等工具）



• **python-dotenv**（环境变量加载）



• **uvicorn**（ASGI 运行）



**合约**



• **Solidity ^0.8.x**



• **Foundry**（编译/测试/部署）



• **OpenZeppelin Contracts**（ERC721，用于 NFT 改造）



• **Sepolia**（目标链）



**前端**



• Next.js + React + TypeScript



• wagmi + viem



• UI：TailwindCSS



• 图表：ECharts



**基础设施（可选）**



• Vercel（前端部署）



• Render（后端部署）



---

## 交付说明（交付前复核）

**项目名称**：HOPE小希 - 28天心灵成长之旅（原 Alive28）

**交付范围**

• **前端**：Next.js 14 + wagmi/viem + TailwindCSS；页面：首页、每日打卡 `/daily/[dayIndex]`、进度 `/progress`、周报/结营报告 `/report`、里程碑 `/milestone/1|2|final`。支持钱包连接或手动输入地址；断开钱包后清空本地身份并跳回首页。

• **后端**：FastAPI + SQLModel + SpoonOS Graph Agent；接口：/health（含 demo_mode）、/dailyPrompt、/homeSnapshot、/dailySnapshot、/checkin、/tx/confirm、/milestone/mint、/progress、/report、/metadata、/ai/reflection、/ai/generate-nft 等。

• **DEMO 模式**：后端 DEMO_MODE 由环境变量控制；/health 返回 demo_mode，前端里程碑页据此决定「记录里程碑」是否上链（DEMO 仅记录，非 DEMO 连接钱包须上链铸造）。

• **里程碑 NFT 展示**：使用 frontend/public/nft 下 week1.svg、week2.svg、final.svg，无需合约即可在里程碑页展示；是否上链铸造由后端 demo_mode 与前端配置的合约地址共同决定。

**环境与启动**

• 后端：Python 3.12+，依赖见 backend/requirements.txt；.env 参考 backend/.env.example（必填 DEEPSEEK_API_KEY 等）。

• 前端：Node.js，依赖见 frontend/package.json；.env 参考 frontend/.env.example（NEXT_PUBLIC_API_BASE 必填）。

• 快速启动：见项目根目录 README.md 与 docs/startup.md。

**交付前检查**

• 后端 /health 返回 status、version、demo_mode。

• 前端可连接后端完成打卡、进度、报告、里程碑展示与记录。

• 断开钱包后刷新/重启前端，不再显示原钱包打卡数据（地址来源与缓存逻辑已按「钱包/手动」区分）。































